<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="./css/bootstrap.css" rel="stylesheet" media="screen">
    <script
            src="https://code.jquery.com/jquery-2.2.4.min.js"
            integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
            crossorigin="anonymous"></script>
    <script src="./js/bootstrap.js"></script>
    <script src="./js/bootstrap-treeview.min.js"></script>
    <title>Title</title>
    <script>
        function getGitTree(contentURL) {
            let data = null;
            $.ajax({
                url: contentURL,
                headers: {Authorization:'token ' + '3646292e23cc66903872860a07218cd0f0cb130c'},
                type: "GET",
                async: false,
                success: function(result) {
                    let fileTree = [];
                    result.forEach(function(item) {
                        if (item['type'] === 'dir')
                            fileTree.push({text: item['name'], state: {expanded: false}, nodes: getGitTree(item['url'])});
                        else {
                            if (item['download_url'] !== null && item['type'] === 'file')
                                fileTree.push({text: item['name'], href: item['download_url']})
                            else
                                fileTree.push({text: item['name']})

                        }
                    });
                    data = fileTree;
                },
                error:function(error) {
                    console.log('Error ' + error)
                }
            });
            return data
        }
        function getData(datasetID) {
            $.ajax({
                url: 'https://raw.githubusercontent.com/OpenNeuroDatasets/ds002718/master/README',
                type: "GET",
                // async: false,
                success: function(result) {
                    $('#README').html(result)
                },
                error:function(error) {
                    console.log('Error ' + error)
                }
            });
            $.ajax({
                url: 'https://raw.githubusercontent.com/OpenNeuroDatasets/ds002718/master/dataset_description.json',
                type: "GET",
                // async: false,
                success: function(result) {
                    $('#datasetDescription').html(result)
                    const json = JSON.parse(result)
                    $('#datasetTitle').html(json['Name'])
                },
                error:function(error) {
                    console.log('Error ' + error)
                }
            });
            let gitTree = null

//            // code to get file tree from scratch
//             const query = 'https://api.github.com/repos/OpenNeuroDatasets/'+datasetID+'/contents/';
//             gitTree = getGitTree(query)
//             const myJSON = JSON.stringify(gitTree)
//             // create a link DOM fragment
//             var $link = $("<a />");
// // encode any special characters in the JSON
//             var text = encodeURIComponent( myJSON );
//
// // <a download="filename.txt" href='data:application/octet-stream,...'></a>
//             $link
//                 .attr( "download", "filename.txt" )
//                 .attr( "href", "data:application/octet-stream," + text )
//                 .appendTo( "body" )
//                 .get(0)
//                 .click()
            // reload saved tree
            const ds002718TreeLink = 'https://raw.githubusercontent.com/dungscout96/NEMAR-dataset-viewer/master/ds002718TreeWithLinks.txt';
            $.ajax({
                url: ds002718TreeLink,
                type: "GET",
                // async: false,
                success: function(result) {
                    gitTree = result;
                    $('#tree').treeview({data: gitTree, showBorder: true, enableLinks: true});
                },
                error:function(error) {
                    console.log('Error ' + error)
                }
            });
            // $('#tree').treeview({data: gitTree, showBorder: true, enableLinks: true});
        }
    </script>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
                <h1 id="datasetTitle"></h1>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-6">
                <div class="jumbotron">
                    <h2>README</h2>
                    <pre id="README"></pre>
                </div>
                <div class="jumbotron">
                    <h2>Dataset description</h2>
                    <pre id="datasetDescription"></pre>
                </div>
            </div>
            <div class="col-lg-6">
                <h3>File Tree Browser</h3>
                <div id="tree"></div>
            </div>
        </div>
    </div>
    <script>
        getData('ds002718');
    </script>

    <script>
    </script>
</body>
</html>